import{d as x,x as Z,T as C,k as q,o as c,c as Q,w as b,a as t,e as i,b as p,t as n,u as m,j as S,i as A,h,f as g,F as E,g as B,l as X,A as ee}from"./app.js";import{_ as te}from"./AppLayout.js";import{_ as re}from"./DateFormat.js";import{C as f}from"./index14.js";import{_ as se}from"./ArticleBlock.js";import{_ as $,I as oe}from"./File.js";import"./_plugin-vue_export-helper.js";import"./LanguageSwitcher.js";const ne={class:"min-h-screen justify-center items-center flex flex-col min-w-0 break-words w-full mb-6 shadow-lg rounded-lg bg-blueGray-100 border-0"},ae={class:"w-full sm:max-w-7xl mt-6 px-6 py-4 bg-white shadow-md overflow-hidden sm:rounded-lg"},ce={key:0,class:"rounded-t mb-0 px-4 py-3 border-0"},ie={class:"flex flex-wrap items-center"},le={class:"w-full flex overflow-x-auto custom-scrollbar"},de={class:"flex-1 px-2"},ue={class:"h-16 flex items-center justify-between"},pe={class:"flex items-center"},me=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z","clip-rule":"evenodd"})],-1),fe={class:"text-sm font-bold"},ye={class:"flex items-center"},_e=t("span",{class:"bg-gray-300 h-6 w-[.5px] mx-3"},null,-1),he={class:"flex items-center space-x-2"},we=t("svg",{width:"20px",height:"20px",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("g",{id:"SVGRepo_bgCarrier","stroke-width":"0"}),t("g",{id:"SVGRepo_tracerCarrier","stroke-linecap":"round","stroke-linejoin":"round"}),t("g",{id:"SVGRepo_iconCarrier"},[t("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M1.84998 7.49998C1.84998 4.66458 4.05979 1.84998 7.49998 1.84998C10.2783 1.84998 11.6515 3.9064 12.2367 5H10.5C10.2239 5 10 5.22386 10 5.5C10 5.77614 10.2239 6 10.5 6H13.5C13.7761 6 14 5.77614 14 5.5V2.5C14 2.22386 13.7761 2 13.5 2C13.2239 2 13 2.22386 13 2.5V4.31318C12.2955 3.07126 10.6659 0.849976 7.49998 0.849976C3.43716 0.849976 0.849976 4.18537 0.849976 7.49998C0.849976 10.8146 3.43716 14.15 7.49998 14.15C9.44382 14.15 11.0622 13.3808 12.2145 12.2084C12.8315 11.5806 13.3133 10.839 13.6418 10.0407C13.7469 9.78536 13.6251 9.49315 13.3698 9.38806C13.1144 9.28296 12.8222 9.40478 12.7171 9.66014C12.4363 10.3425 12.0251 10.9745 11.5013 11.5074C10.5295 12.4963 9.16504 13.15 7.49998 13.15C4.05979 13.15 1.84998 10.3354 1.84998 7.49998Z",fill:"#000000"})])],-1),xe=[we],ge=t("div",{class:"px-2 flex items-center space-x-4"},null,-1),be={class:"mb-6"},ve={class:"text-lg text-gray-800 font-bold pb-2 mb-4 border-b-2"},ke={class:"flex flex-wrap items-start justify-between mb-2"},Ce={class:"flex items-center"},Se=t("i",{class:"fas fa-user-secret mr-2 text-lg text-blueGray-400 rounded-full w-8 h-8 border border-gray-500 text-center"},null,-1),Ae={class:"flex flex-col ml-2"},Ee={class:"text-sm font-semibold"},Be={key:0,class:"text-xs text-gray-400"},$e={class:"text-sm text-gray-500"},Ge=t("i",{class:"fas fa-fire mr-2 text-blueGray-400"},null,-1),Re=t("i",{class:"fas fa-hourglass mr-2 text-blueGray-400"},null,-1),Fe=t("i",{class:"fas fa-folder-open mr-2 text-blueGray-400"},null,-1),Pe={key:0},Te=t("i",{class:"fas fa-code-branch mr-2 text-blueGray-400"},null,-1),Ve={class:"py-6 pl-2 text-gray-700"},De={class:"border-t-2 flex space-x-4 py-4"},ze={class:"max-w-100-px"},Me=t("label",{for:"upload-file",class:"w-16 flex items-center py-2.5 px-2 border-2 border-gray-300 rounded-lg hover:bg-gray-200 cursor-pointer"},[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("g",{id:"SVGRepo_bgCarrier","stroke-width":"0"}),t("g",{id:"SVGRepo_tracerCarrier","stroke-linecap":"round","stroke-linejoin":"round"}),t("g",{id:"SVGRepo_iconCarrier"},[t("path",{d:"M15 12L12 12M12 12L9 12M12 12L12 9M12 12L12 15",stroke:"#1C274C","stroke-width":"1.5","stroke-linecap":"round"}),t("path",{d:"M7 3.33782C8.47087 2.48697 10.1786 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 10.1786 2.48697 8.47087 3.33782 7",stroke:"#1C274C","stroke-width":"1.5","stroke-linecap":"round"})])])],-1),Ke={class:"w-auto flex flex-wrap gap-1"},Ne={key:0,class:"flex items-center"},je={key:1,class:"flex items-center"},Le={key:2,class:"items-center"},Ie={key:1,class:"mt-8 flex items-center flex-col space-x-4"},Ue={class:"max-w-4xl w-full mx-auto px-4"},He=["onSubmit"],Oe={class:"flex-auto w-full"},Je={class:"flex flex-wrap"},Ye={class:"relative w-full mb-3"},We={class:"block uppercase text-blueGray-600 text-xs font-bold mb-2",for:"comment"},Ze={key:0,class:"text-red-600"},qe=["disabled"],Qe={class:"max-w-4xl w-full mx-auto px-4"},Xe={class:"w-full"},et={key:2,class:"w-full lg:w-12/12 px-4 mt-6"},tt={class:"w-full flex mt-4 lg:w-12/12 px-6 text-left"},rt={class:"h-16 flex items-center justify-between"},st={class:"flex items-center"},ot=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z","clip-rule":"evenodd"})],-1),nt={class:"text-sm font-bold"},ft={__name:"ReportSummary",props:{access_keys:Array,occurrence:Array,password:x(""),full_password:x(""),comments:Array,severity_types:Array},setup(G){const o=G,R=async e=>{e.preventDefault();let s=C({password:o.full_password});return s.post(route("occurrences.post.report.reload"),{onSuccess:async()=>!0,onError:async()=>console.log(s.errors)}),!0},F=e=>(o.severity_types.hasOwnProperty(e)||(e=3),o.severity_types[e]),y=x("");Z(async()=>{const e=await M(o.access_keys.whistleblower_private_key,z.value);await K(e,o.access_keys.whistleblower_public_key)});const l=C({id:o.occurrence.id,comment:"",comment_id:"",occurrence:o.occurrence}),P=async()=>{l.comment&&await axios({method:"post",url:route("occurrences.post.comment.guest"),data:{id:l.id,comment:await I(l.comment),comment_id:l.comment_id,password:o.full_password,occurrence:o.occurrence}}).then(function(e){e.status===200&&(o.comments=e.data.comments,l.reset())}).catch(function(e){console.log(e.toJSON())})},T=e=>{let s=o.comments.find(r=>r.id===e);Object.keys(s).length&&(l.comment=s.text,l.comment_id=s.id)},V=e=>e?e.profile_photo_url:"https://ui-avatars.com/api/?name=N+O&color=7F9CF5&background=EBF4FF",D=(e,s)=>e?e.name:s("Whistleblower User"),z=q(()=>f.PBKDF2(o.password,"",{keySize:128/32}).toString());async function M(e,s){const r=v(e),a=v(s),d=r.slice(0,12),_=r.slice(12);try{const u=await window.crypto.subtle.importKey("raw",a,{name:"AES-GCM"},!1,["decrypt"]),W=await crypto.subtle.decrypt({name:"AES-GCM",iv:d},u,_);return new TextDecoder().decode(W)}catch(u){console.error("Error decrypting the data:",u)}}function v(e){const s=[];for(let r=0;r<e.length;r+=2)s.push(parseInt(e.substr(r,2),16));return new Uint8Array(s)}async function K(e,s){let r=await j(e),a=window.atob(s),d=k(a),_=await N(r,d),u=new TextDecoder().decode(_);return y.value=u}async function N(e,s){return await window.crypto.subtle.decrypt({name:"RSA-OAEP"},e,s)}async function j(e){return await window.crypto.subtle.importKey("pkcs8",L(e),{name:"RSA-OAEP",hash:"SHA-256"},!0,["decrypt"])}function L(e){const s="-----BEGIN PRIVATE KEY-----",r="-----END PRIVATE KEY-----",a=e.substring(s.length,e.length-r.length),d=window.atob(a);return k(d)}function k(e){const s=new ArrayBuffer(e.length),r=new Uint8Array(s);for(let a=0,d=e.length;a<d;a++)r[a]=e.charCodeAt(a);return s}function w(e){try{return f.AES.decrypt(e,y.value).toString(f.enc.Utf8)}catch{return f.AES.decrypt(e,y.value).toString(f.enc.Latin1)}}async function I(e){return e&&y.value?f.AES.encrypt(e,y.value).toString():null}const U=x(!0),H=async e=>{if(e){if(J(e.type)===!1)return;let s=await Y(e),r={file_name:e.name,mime_type:e.type,data_base64:s,size:e.size},a=JSON.stringify(r);try{await O(a)}catch(d){console.log(d)}}},O=async e=>{await axios({method:"post",url:route("occurrences.post.report.files"),data:{id:o.occurrence.id,file:e,password:o.full_password}}).then(function(s){s.status===200&&(o.occurrence=s.data.occurrence)}).catch(function(s){console.log(s.toJSON())})},J=e=>["image/jpeg","image/png","image/gif","image/svg+xml","text/plain","application/pdf"].includes(e)?!0:(alert("File type not allowed. Please select a different file."),U.value=!1);async function Y(e){return new Promise((s,r)=>{const a=new FileReader;a.onload=function(d){const _=d.target.result,u=f.AES.encrypt(_,y.value).toString();s(u)},a.readAsDataURL(e)})}return(e,s)=>(c(),Q(te,{title:"Check Report"},{default:b(()=>[t("div",ne,[t("div",ae,[o.occurrence.topic?(c(),i("div",ce,[t("div",ie,[t("div",le,[t("div",de,[t("div",ue,[t("div",pe,[p(m(S),{class:"flex items-center text-gray-700 px-2 py-1 space-x-0.5 border border-gray-300 rounded-lg shadow hover:bg-gray-200 transition duration-100",title:"Back",href:e.route("occurrences.index")},{default:b(()=>[me,t("span",fe,n(e.$t("Back")),1)]),_:1},8,["href"]),t("div",ye,[_e,t("div",he,[t("button",{onClick:s[0]||(s[0]=A(r=>R(r),["prevent"])),title:"reload",class:"text-gray-700 px-2 py-1 border border-gray-300 rounded-lg shadow hover:bg-gray-200 transition duration-100 cursor-pointer"},xe)])])]),ge]),t("div",be,[t("h4",ve,n(e.$t("Your case"))+" : "+n(w(o.occurrence.topic)),1),t("div",ke,[t("div",Ce,[Se,t("div",Ae,[t("span",Ee,n(o.occurrence.classification),1),o.occurrence.email?(c(),i("span",Be,n(e.$t("From"))+": "+n(w(o.occurrence.email)),1)):h("",!0)])]),t("div",$e,[t("span",null,[Ge,g(n(e.$t("Severity"))+" : "+n(e.$t(F(o.occurrence.severity)))+" | ",1)]),t("span",null,[Re,g(n(e.$t("Status"))+" : "+n(e.$t(o.occurrence.status))+" | ",1)]),t("span",null,[Fe,g(n(e.$t("Category"))+" : "+n(o.occurrence.categories.name)+" | ",1)]),o.occurrence.departments?(c(),i("span",Pe,[Te,g(n(e.$t("Department"))+" : "+n(o.occurrence.departments.name)+" | ",1)])):h("",!0),t("span",null,[p(re,{date:o.occurrence.created_at,hasTime:"true"},null,8,["date"])])])]),t("div",Ve,n(w(o.occurrence.description)),1),t("div",De,[t("div",ze,[Me,t("input",{type:"file",id:"upload-file",name:"file",class:"hidden",onInput:s[1]||(s[1]=r=>H(r.target.files[0]??""))},null,32)]),t("div",Ke,[o.occurrence.files.length>0?(c(!0),i(E,{key:0},B(o.occurrence.files,(r,a)=>(c(),i("div",{class:"w-70 flex items-center py-2.5 px-2 border-2 border-gray-300 rounded-lg hover:bg-gray-200",key:a},[r.mime_type==="text/plain"?(c(),i("div",Ne,[p($,{occurrences:o.occurrence,encryptedText:r.data_base64,type:1,name:r.file_name,size:r.size},null,8,["occurrences","encryptedText","name","size"])])):r.mime_type==="application/pdf"?(c(),i("div",je,[p($,{occurrences:o.occurrence,encryptedText:r.data_base64,type:1,name:r.file_name,size:r.size},null,8,["occurrences","encryptedText","name","size"])])):(c(),i("div",Le,[p(oe,{occurrences:o.occurrence,type:1,name:r.file_name,size:r.size,encryptedText:r.data_base64},null,8,["occurrences","name","size","encryptedText"])]))]))),128)):h("",!0)])])])])])])])):h("",!0),o.occurrence.topic?(c(),i("div",Ie,[t("div",Ue,[t("form",{onSubmit:A(P,["prevent"])},[t("div",Oe,[t("div",Je,[t("div",Ye,[t("label",We,n(e.$t("Comment(s)")),1),X(t("textarea",{type:"text",class:"border-0 px-3 py-3 placeholder-blueGray-300 text-blueGray-600 bg-white rounded text-sm shadow focus:outline-none focus:ring w-full ease-linear transition-all duration-150",rows:"6",name:"comment","onUpdate:modelValue":s[2]||(s[2]=r=>m(l).comment=r)},null,512),[[ee,m(l).comment]]),m(l).errors.comment?(c(),i("span",Ze,n(e.$t(m(l).errors.comment)),1)):h("",!0)]),t("button",{disabled:m(l).processing,class:"bg-emerald-500 text-white active:bg-emerald-600 font-bold uppercase text-xs px-4 py-2 rounded shadow hover:shadow-md outline-none focus:outline-none mr-1 ease-linear transition-all duration-150",type:"submit"},n(e.$t("Post comment")),9,qe)])])],40,He)]),t("div",Qe,[(c(!0),i(E,null,B(o.comments,(r,a)=>(c(),i("div",Xe,[p(se,{id:r.id,name:D(r.user,e.$t),date:r.created_at,content:w(r.text),profile_img:V(r.user),onEditComment:T,user_id:r.user_id},null,8,["id","name","date","content","profile_img","user_id"])]))),256))])])):(c(),i("div",et,n(e.$t("Could not find report")),1)),t("div",tt,[t("div",rt,[t("div",st,[p(m(S),{class:"flex items-center text-gray-700 px-2 py-1 space-x-0.5 border border-gray-300 rounded-lg shadow hover:bg-gray-200 transition duration-100",title:"Back",href:e.route("occurrences.index")},{default:b(()=>[ot,t("span",nt,n(e.$t("Back")),1)]),_:1},8,["href"])])])])])])]),_:1}))}};export{ft as default};
